document.addEventListener('DOMContentLoaded', function () {
    const appointmentForm = document.querySelector('#cf-token-appointment-form');
    const timeSlots = document.querySelectorAll('.time-slot');
    const serviceOptions = document.querySelectorAll('.service-option');
    const dateInput = document.querySelector('#appointmentDate'); const submitBtn = document.querySelector('#submitAppointment'); let selectedTime = ''; let selectedService = ''; if (dateInput) { const today = new Date(); const tomorrow = new Date(today); tomorrow.setDate(tomorrow.getDate() + 1); dateInput.min = tomorrow.toISOString().split('T')[0]; const maxDate = new Date(today); maxDate.setDate(maxDate.getDate() + 90); dateInput.max = maxDate.toISOString().split('T')[0]; }
    timeSlots.forEach(slot => { slot.addEventListener('click', function () { timeSlots.forEach(s => s.classList.remove('selected')); this.classList.add('selected'); selectedTime = this.dataset.time; document.querySelector('#appointmentTime').value = selectedTime; }); }); serviceOptions.forEach(option => { option.addEventListener('click', function () { serviceOptions.forEach(s => s.classList.remove('selected')); this.classList.add('selected'); selectedService = this.dataset.service; document.querySelector('#serviceType').value = selectedService; }); }); if (appointmentForm) { appointmentForm.addEventListener('submit', function (e) { e.preventDefault(); if (!validateForm()) { return; } const formData = new FormData(this); const submitButton = this.querySelector('button[type="submit"]'); const originalText = submitButton.textContent; submitButton.disabled = true; submitButton.textContent = 'Gönderiliyor...'; fetch('/?/control/form/post/appointmentForm', { method: 'POST', body: formData }).then(response => response.json()).then(data => { if (data.status === 'success') { showAlert('Randevu talebiniz başarıyla gönderildi. En kısa sürede size dönüş yapacağız.', 'success'); appointmentForm.reset(); timeSlots.forEach(s => s.classList.remove('selected')); serviceOptions.forEach(s => s.classList.remove('selected')); selectedTime = ''; selectedService = ''; } else { showAlert(data.message || 'Bir hata oluştu. Lütfen tekrar deneyin.', 'error'); } }).catch(error => { console.error('Error:', error); showAlert('Bir hata oluştu. Lütfen tekrar deneyin.', 'error'); }).finally(() => { submitButton.disabled = false; submitButton.textContent = originalText; }); }); }
    function showAlert(message, type) {
        const existingAlert = document.querySelector('.alert'); if (existingAlert) { existingAlert.remove(); }
        const alertDiv = document.createElement('div'); alertDiv.className = `alert alert-${type}`; alertDiv.textContent = message; const formContainer = document.querySelector('.appointment-form-container'); formContainer.appendChild(alertDiv); setTimeout(() => { alertDiv.remove(); }, 5000);
    }
    function validateForm() { const requiredFields = ['namesurname', 'email', 'phone', 'appointmentDate', 'appointmentTime']; let isValid = true; requiredFields.forEach(fieldName => { const field = document.querySelector(`[name="${fieldName}"]`); if (!field || !field.value.trim()) { isValid = false; if (field) { field.classList.add('is-invalid'); } } else { field.classList.remove('is-invalid'); } }); return isValid; }
    const phoneInput = document.querySelector('#phone'); if (phoneInput) { phoneInput.addEventListener('input', function () { this.value = this.value.replace(/[^0-9+()-\s]/g, ''); }); }
    const emailInput = document.querySelector('#email'); if (emailInput) { emailInput.addEventListener('blur', function () { const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/; if (this.value && !emailRegex.test(this.value)) { this.classList.add('is-invalid'); showAlert('Lütfen geçerli bir e-posta adresi girin.', 'error'); } else { this.classList.remove('is-invalid'); } }); }
});
